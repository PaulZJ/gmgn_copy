# Flutter Web 性能优化指南

## 问题分析

Flutter Web 项目启动时出现白屏的主要原因：

### 1. 同步初始化阻塞
- `GlobalStore.init()` 在应用启动时同步执行
- SharedPreferences 在 Web 环境下性能较慢
- 阻塞了 UI 渲染

### 2. 大量资源加载
- 过多的字体文件（Rubik、Nunito、Fredoka、Quicksand 等）
- 首次访问时没有缓存
- 需要下载 Dart 代码和资源

### 3. 缺少加载状态指示
- 用户只能看到白屏
- 没有视觉反馈

## 优化方案

### 1. 异步初始化
```dart
// 修改前：同步初始化
final globalStore = GlobalStore();
await globalStore.init();
runApp(MyApp(globalStore: globalStore));

// 修改后：异步初始化
runApp(const MyApp());
// 在 MyApp 中异步初始化
```

### 2. 启动画面
- 添加了 `SplashScreen` 组件
- 显示应用 Logo 和加载指示器
- 提供视觉反馈

### 3. 字体优化
- 减少字体文件数量
- 只保留必要的字体变体
- 使用可变字体减少文件大小

### 4. Web 配置优化
- 添加预加载配置
- 优化 HTML 结构
- 添加启动画面样式

### 5. 性能配置
- 创建 `PerformanceConfig` 类
- 统一管理性能相关配置
- 支持平台特定优化

## 具体改进

### main.dart 优化
- 移除了同步初始化
- 添加了启动画面
- 设置了初始化超时
- 使用性能配置

### GlobalStore 优化
- 并行执行初始化操作
- 添加错误处理
- 优化数据解析

### Web 配置优化
- 添加了预加载标签
- 优化了 HTML 结构
- 添加了启动画面样式

### 字体配置优化
- 减少了字体文件数量
- 只保留必要的字体变体

## 性能提升效果

1. **启动时间减少**：异步初始化避免了阻塞
2. **用户体验改善**：启动画面提供视觉反馈
3. **资源加载优化**：减少字体文件大小
4. **错误处理增强**：添加了超时和错误处理

## 使用建议

1. **开发环境**：启用性能日志记录
2. **生产环境**：启用所有优化选项
3. **监控性能**：使用浏览器开发者工具监控加载时间
4. **持续优化**：定期检查和优化资源大小

## 进一步优化建议

1. **代码分割**：使用路由级别的代码分割
2. **图片优化**：使用 WebP 格式和懒加载
3. **缓存策略**：实现更智能的缓存策略
4. **CDN 加速**：使用 CDN 加速资源加载
5. **Service Worker**：实现离线缓存 